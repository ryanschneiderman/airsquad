<script>

    var gm_canvas_height = $(document).width()/2.31;
    var gm_canvas_width = $(document).width()/1.645;
    var img = new Image();
    var background_img;
    img.onload = function() {
        // this is syncronous
        background_img = new fabric.Image(img);
        background_img.objectCaching = false;
        background_img.scaleToHeight(gm_canvas_height);
        canvas.setBackgroundImage(background_img, canvas.renderAll.bind(canvas), {
            top: 0,
            left: 0
        });
        set_canvas_dimensions();

        canvas.requestRenderAll.bind(canvas);
    };
    img.src = "<%= asset_path('halfcourt.png')%>";

    var canvas = new fabric.Canvas('c',{
        targetFindTolerance: 15,
         perPixelTargetFind: true,
         preserveObjectStacking: true,
    }); 

    $(window).resize(function(){
        console.log("resizing");
        gm_canvas_height = $(document).width()/2.31;
        gm_canvas_width = $(document).width()/1.645;
        set_canvas_dimensions();
    })

    
    function set_canvas_dimensions(){
        canvas.setHeight(gm_canvas_height);
        canvas.setWidth(gm_canvas_width);
        background_img.scaleToHeight(gm_canvas_height);
        canvas.setBackgroundImage(background_img, canvas.renderAll.bind(canvas), {
            top: 0,
            left: 0
        });
    }

</script>